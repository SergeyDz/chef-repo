#!/bin/bash
# This file is generated by Chef

# evironmental variables
<%= @env.map{|k,v| "#{k}=\"#{v}\""}.join("\n") %>

# set ulimit if defined
[[ ! ${ULIMIT:-} ]] || ulimit $ULIMIT

<%- if @syslog -%>
# stdout and stderr to syslog
exec 1> >(exec logger -p user.info -t "<%= ::File.basename(@bin) %>")
exec 2> >(exec logger -p user.err  -t "<%= ::File.basename(@bin) %>")
<%- end -%>

# mesos binary configuration
exec <%= @bin %> \
<%- @flags.sort.each do |flag, value|                                      -%>
<%-   case value                                                           -%>
<%-   when Hash                                                            -%>
  <%=   "--#{flag}='"%><%= value.map{|k,v| "#{k}:#{v}"}.join(';') %><%= "'" %> \
<%-   when String, Integer                                                 -%>
  <%=   "--#{flag}=#{value}"                                                %> \
<%-   else                                                                 -%>
  <%=   "--#{value ? '' : 'no-'}#{flag}"                                    %> \
<%-   end                                                                  -%>
<%- end                                                                    -%>
